name: CI

on:
  push:
  release:
    types:
      - published

jobs:
  build:
    name: Build
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Generate Changelog (Latest)
        env:
          OUTPUT: changelog/CHANGELOG.latest.md
          GITHUB_TOKEN: ${{ github.token }}
          GITHUB_REPO: ${{ github.repository }}
        uses: orhun/git-cliff-action@v4
        with:
          config: ${{ github.action_path }}/cliff.toml
          args: --latest --strip all
          github_token: ${{ github.token }}
      - name: Generate Changelog (Current)
        env:
          OUTPUT: changelog/CHANGELOG.current.md
          GITHUB_TOKEN: ${{ github.token }}
          GITHUB_REPO: ${{ github.repository }}
        uses: orhun/git-cliff-action@v4
        with:
          config: ${{ github.action_path }}/cliff.toml
          args: --current --strip all
          github_token: ${{ github.token }}
      - name: Generate Changelog (Unreleased)
        env:
          OUTPUT: changelog/CHANGELOG.unreleased.md
          GITHUB_TOKEN: ${{ github.token }}
          GITHUB_REPO: ${{ github.repository }}
        uses: orhun/git-cliff-action@v4
        with:
          config: ${{ github.action_path }}/cliff.toml
          args: --unreleased --strip all
          github_token: ${{ github.token }}
      - name: Cat Changelog (Latest)
        run: cat changelog/CHANGELOG.latest.md
      - name: Cat Changelog (Current)
        run: cat changelog/CHANGELOG.current.md
      - name: Cat Changelog (Unreleased)
        run: cat changelog/CHANGELOG.unreleased.md
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: changelog
          path: changelog/
